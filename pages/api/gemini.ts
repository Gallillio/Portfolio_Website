import type { NextApiRequest, NextApiResponse } from 'next';

export default async function handler(req: NextApiRequest, res: NextApiResponse) {
  const apiKey = process.env.GEMINI_API_KEY!;
  const { message, conversationHistory } = req.body;

  try {
    const response = await fetch(
      `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`,
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          contents: [
            {
              role: "user",
              parts: [
                {
                  text: `My name is Ahmed Galal Elzeky. (My nickname is Gallillio) I am an AI and software developer.\nBio\nI architect and deploy enterprise-grade AI solutions that transform how organizations operate. From building secure, on-premises LLM assistants for banks and telecom giants using IBM Watsonx, to developing computer vision systems that save companies thousands in operational costs, my work spans the full spectrum of AI engineering—NLP, computer vision, deep learning, and cloud-native applications.\nLeveraging Python, React.js, Microsoft Azure, and IBM Watsonx, I've delivered solutions that earned international recognition—including the Times Higher Education Award 2024 for technological innovation and representing Egypt & North Africa in the GESAwards Global Finals with my startup GPTuBE. My research on Arabic LLM reasoning was published in Elsevier Procedia, and I've led enterprise AI workshops for C-suite executives across leading organizations.\nSkills\nAI & Machine Learning\nNLP\nComputer Vision\nDeep Learning\nMachine Learning\nTensorFlow\nOpenCV\nLangChain\nPowerBI\n\nCloud & AI Platforms\nMicrosoft Azure\nGoogle Cloud\nIBM Watsonx\nIBM Cloud\n\nWeb & Application Development\nJavaScript\nTypeScript\nReactJS\nNextJS\nNode.js\nExpressJS\nFastAPI\nDjango\nFlask\nMongoDB\n\nREST APIs\n\nOpenAPI\nC#\nUnity\nTailwind\n\nDevOps & Tools\nGit\nCursor\nVercel\nV0\nPostman\nLinux\nAgile/Scrum\nNotion\n\nDesign & Collaboration\nFigma\nJira\nTrello\nSlack\n\nProfessional Experience\nAI Engineer\nIntelligent Systems (I-Sys)\n•\nFeb. 2025 - Present\nIBM Watsonx\nIBM Cloud\nDocker\nKubernetes\nOpenAPI Specification (OAS)\nLLMs\nData Pipelines\n• Developed secure, on-premises AI assistant platforms for banks and telecom clients using IBM technologies (Watsonx.ai, Watsonx Orchestrate, Watsonx Discovery), enabling ChatGPT-like interaction while preserving data confidentiality and compliance.\n• Created AI agents that automate common employee tasks including calendar integration, meeting scheduling, email handling, and auto-generating Word and Excel reports through conversational input.\n• Created custom LLM-based solutions capable of handling document uploads (.docx, .pdf, etc.) and performing RAG (Retrieval-Augmented Generation) over internal knowledge to answer user questions with precision.\n• Trained Text-to-Speech (TTS) and Speech-to-Text (STT) models tailored for Egyptian and Saudi Arabic dialects, for use in voice assistants and customer service phone systems.\n• Integrated dialect-specific NLP and speech models into client applications, enhancing accessibility and usability for local end-users in voice-based interfaces.\n• Collaborated with UK-based firm EmoTech to build conversational virtual avatars for public-facing services, delivering interactive Arabic voice assistants powered by dialectal LLMs.\n• Led client demos, and high-impact AI workshops and technical demonstrations, including presenting enterprise-grade solutions to C-suite executives from leading firms. Conducted one-on-one strategic consultations to identify pain points and tailor AI integration road-maps for each organization. Workshop Showcase: @https://www.linkedin.com/feed/update/urn:li:activity:7342125077758390273/\n\n\n\nAI Developer Intern\nEnviron Adapt\n•\nAug. 2024 - Oct. 2024\nTensorFlow\nOpenCV\nKeras\nDeep Neural Networks\nImage Processing\nData Science\n• Using Tensorflow and OpenCV to create Siamese Networks that was used in an image recognition model to distinguish between identical trash bales and bales viewed from different angles, automating a previously manual task and significantly reducing company costs in storage and payments by thousands of Egyptian pounds.\n• Designed and implemented a validation model to assess image quality against stakeholder-defined requirements, ensuring compliance and improving precision in image verification processes.\n\n\n\nAI Developer Intern\nEcole Supérieure Libre des Sciences Commerciales Appliquées (ESLSCA University)\n•\nFeb. 2024 - Apr. 2024\nMicrosoft Azure\nLangchain\nOpenAI Function Calling\nVector Database\nRAG\n• Developed a project, earning ESLSCA University The Times Highest Higher Education Award 2024 in Technological/Digital Innovation at the Arab Summit of Universities, Dubai.\n• Used Langchain Framework and OpenAI Function Calling to build a GPT-powered (using Azure OpenAI) chatbot that guides prospective students, provides real-time updates, and automates document processing and verification.\n• Streamlined admissions by reducing processing times, enhancing communication, and reallocating staff for personalized support, boosting efficiency.\n• Integrated Chroma Vector Database and RAG to provide the chatbot for contextual awareness.\n\n\nXR Developer\nGMind\n•\nJul. 2023 - Oct. 2023\nC#\nUnity\nObject-Oriented Programming (OOP)\nGame Development\nGame Design\n• Used C# to implementing player mechanics and complex AI behavior of NPCs and player interactions.\n• Gained a clear understanding of Object-Oriented Programming\n• Refine tasks to help to achieve the vision of the game designer.Education\nB.S. in Computer Science\nEcole Supérieure Libre des Sciences Commerciales Appliquées (ESLSCA University)\n•Sep. 2021 - Sep. 2024\nFocus: AI & Data Science\n\nJapanese Language and Business Manner\nHuman Academy\n•Oct. 2024 - Jan. 2025\nFocus: Reached N4 Japanese Language Level\n\nLanguages\nEnglish\nNative Language (IELTS 7.5)\nArabic\nNative Language\nJapanese\nConversational Level (JLPT N4)\n\nCourses\nNote: These are courses I\'ve taken. For certifications, please visit My Achievements / Publications / Certifications\nDesigning and Implementing a Microsoft Azure AI Solution\nMicrosoft\nFeb. 2025\nMicrosoft Azure AI Fundamentals\nMicrosoft\nFeb. 2025\nMicrosoft Azure Fundamentals\nMicrosoft\nFeb. 2025\nPractitioner Watsonx Assistant\nIBM\nFeb. 2025\nWatsonx Orchestrate Intermediate\nIBM\nFeb. 2025\nLinux Adminstration\nNew Horizons\nJul. 2023\nSupervised Machine Learning\nDeepLearning.AI\nAug. 2022\nCloud AWS Practitioner\nAmazon\nOct. 2022\nSecurity +\nCompTIA\nApr. 2023\nNetwork +\nCompTIA\nAug. 2022\nCompTIA A+\nCompTIA\nAug. 2022\n\nFreelance Projects\n"IIG-HEC" Company Profile Website\n- Jun. 2023 - Dec. 2023\nA website fofeatures a clean and modern design that effectively showcases the company\'s services, projects, and blog section, providing visitors with a comprehensive overview of IIG-HEC.\nJavaScript\nReactJS\nNodeJS\nExpressJS\nMongoDB\nTailwindCSS\nFirebase\nVercel\n\n\n\nContact Information\nAhmedGalal11045@gmail.com\n+20 1110333933\nNew Cairo, Egypt\n\nPublished Journal of Elsevier\'s Procedia\nhttps://www.sciencedirect.com/science/article/pii/S1877050924029806\nPublished "Multi-Hop Arabic LLM Reasoning in Complex QA".\nPresented in ACLing 2024, the 6th International Conference on AI in Computational Linguistics in Dubai,UAE.\nSep. 2024\nPublication\n\nMicrosoft Certified: Azure AI Engineer Associate\nhttps://learn.microsoft.com/api/credentials/share/en-us/Gallillio/FA9AAA1E4EAF1DC?sharingId=BF374C9707F46C52\nCertified Microsoft Azure AI Engineer.\nStudied for these 3 courses:\n- Microsoft Azure Fundamentals\n- Microsoft Azure AI Fundamentals\n- Designing and Implementing a Microsoft Azure AI Solution\nMay. 2025\nCertification\n\nWinner at the GenAI Hackathon\nhttps://www.linkedin.com/feed/update/urn:li:activity:7330556317721432068/\nWon the Stakpak Hackathon hosted by Stakpak, for presenting the AI-powered Language Learning App shown under the Projects Section.\nMay. 2025\nAward\n\nAwarded The Times Highest Higher Education\nhttps://theawardsarabworld.com/2024/en/page/2024\nRecognized for innovative contributions in educational technology\nFor my work on My University\'s Chatbot Project. Awarded in The Arab Summit of Universities in Dubai University\nDec. 2024\nAward\n\nAwarded Top 3 Finalist in GESAwards Africa\nhttps://www.linkedin.com/posts/ghana-society-for-education-technology_gesawards2024-edtech-innovation-activity-7265332297669746689-uv6Z?utm\nMy startup GPTube won Top 3 finalist in the GESAwards Africa.\nRepresenting Egypt and North Africa internationally\nDec. 2024\nEntrepreneurship\n\nJapanese Language Proficiency\nAchieved JLPT N4 level in Japanese Language during my studies at Human Academy\nJan. 2025\nLanguage\n\nAI Language Learning App\nIn Development\nThis AI-driven app offers a hyper-personalized language learning experience. Key features include a dynamic Word Bank, adaptive Duolingo-style mini-games, story generation using comprehensible input (90% known, 10% new words), and an FSRS-powered Spaced Repetition flashcard system for superior retention. An AI Chatbot Assistant provides tailored guidance, like a personal tutor.\nGenerative AI, NLP, FSRS Algorithm, Adaptive Learning, Gamification\nCode: Not Available\nDemo: Not Available\n\nGPTube\nAn interactive tool that engages users with YouTube videos through a GPT-powered chatbot, utilizing TTS and STT for voice interaction. It features generating mock tests, correcting user answers, and creating PowerPoint presentations.\nMain PageQuestion ExampleQuiz ExamplePresentation Example\nMicrosoft Azure\nGoogle Cloud\nReactJS\nDjango\nLangchain\nVector Database\nRAG\nOpenAI Function Calling\nCode\nDemo\nReal-Time Facial Emotion Classification\nDeveloped a real-time facial emotion classification system using transfer learning (MobileNetV2, VGG) and a custom CNN, achieving 83% accuracy on FER-2013 dataset using fine-tuned MobileNetV2 model.\nNeutral ExpressionHappy ExpressionFearful ExpressionSad ExpressionSurprised Expression\nOpenCV\nCNN\nMobileNetV2\nVGG\nFlask\nCode\nDemo\nIIG-HEC Company Profile Website\nA website for IIG-HEC Company Profile. With a clean and modern design, it showcases the company\'s services, projects, and a blog section.\nIIG-HEC Company Profile WebsiteIIG-HEC Company Profile WebsiteIIG-HEC Company Profile WebsiteIIG-HEC Company Website\nJavaScript\nReactJS\nNodeJS\nExpressJS\nMongoDB\nTailwindCSS\nFirebase\nVercel\nCode\nDemo\nData Visualer and Analysis Tool\nA tool to visualize and analyze data. It provides a user-friendly interface for data exploration and model training, with features for data preprocessing.\nMainHistogram EDAEncode ColumnDetailed EDAHandle NA\nScikit-learn\nNumpy\nPandas\nMatplotlib\nSeaborn\nTkinter\nCode\nDemo\nESLSCA University Chatbot\nA chatbot that streamlines University admissions. Awarded The Times Highest Higher Education Award 2024 for Technological Innovation. It automates document processing and enhances communication with real-time updates.\nNote: This project is currently under development and has undergone several changes.\nESLSCA Chatbot Example\nMicrosoft Azure\nLangchain\nDjango\nOpenAI Function Calling\nVector Database\nRAG\nCode\nDemo\nMy Portfolio Website\nThe website you are currently on! My personal portfolio website showcasing projects, skills, and achievements. Designed as a unique terminal-style website that showcases my skills and projects.\nExplore the website Right Here!\nGoogle Cloud\nTypeScript\nNextJS\nReactJS\nTailwindCSS\nVercel\nCode\nDemo\n\n"Brillium" AI SaaS\nIn Development\nBrillium is an AI-powered LMS that converts PDF textbooks into interactive learning experiences. It generates quizzes, flashcards, and presentations, analyze student performance, and dynamically create questions for improvement. Teachers can monitor and edit content, while a chatbot serves as a personal assistant for students.\n\n⚠️ This project is currently under development ⚠️\nUnder Development\nComing Soon!\n\nGoogle Cloud\nFastAPI\nTesseract OCR\nPython\nReactJS\nNextJS\nNodeJS\nMongoDB\nTailwindCSS\nVercel\nCode\nDemo\n\nAI Quickbooks CFO Assistant – Swipelabs\nIn Development\nA lightweight AI-powered virtual CFO tailored for small business owners, designed to automate financial analysis and provide real-time decision support. Integrated with QuickBooks API for sync of financial data (invoices, A/R, expenses, cash flow). Delivered automated weekly digests via email/Slack summarizing revenue trends, burn rate, overdue invoices, and AI insights. Implemented a scoring algorithm to calculate a Financial Health Score using business-type-adjusted weights (e.g. Burn Multiple, Margin, Runway). Enabled founders to ask finance-related questions via email, receiving GPT-powered replies within minutes. Developed a read-only web dashboard showing financial KPIs, trends, and a diff-style summary of 'What changed this week?' Added tools for forecast simulation and budget tracking, including text-based scenario analysis and alerting for overspending.\n\n⚠️ This project is currently under development ⚠️\nUnder Development\nComing Soon!\n\nNextJS\nPython\nSupabase\nQuickBooks API\nPostmark\nCode\nDemo\n\nSlack AI Assistant – Swipelabs\nIn Development\nBuilt a GPT-powered Slack app designed to assist Swipelabs team members in managing client communication and internal workflows. The assistant enabled seamless interaction via direct messages, internal channels, and Slack Connect, with real-time pings, sentiment cues, and AI-suggested replies. Client package tracking and onboarding workflows, with manual input and automatic reminders for setup completion. Full integration with Trello, ClickUp, and Asana to track deliverables vs. obligations and ping responsible members when tasks were overdue. Smart monitoring of Slack Connect for unanswered messages, deadlines, and client tone, prompting appropriate follow-ups. CRM-style reminders for account managers, with intelligent follow-up nudges after meetings and inactivity alerts. Time tracking via integration or Slack-based input, and automatic weekly/on-demand performance reports sent to managers.\n\n⚠️ This project is currently under development ⚠️\nUnder Development\nComing Soon!\n\nPython\nFlask\nSlack API\nTrello API\nClickUp API\nGoogle Calendar API\nPostgreSQL\nNLP\nCode\nDemo\n
                  All sections of the website: 'Terminal', 'Chat Assistant Mode in the Terminal', 'Projects', 'About(with subsections inside it 'skills', 'Timeline', 'Professional Experience', 'Education', 'Freelance Projects', 'Languages', 'Courses')', 'Contact / CV', 'My Achievements / Publications / Certification', 'Your achievements(the achievements of the user using the website that they collect as they explore the website more)'
                  `
                }
              ]
            },
            {
              role: "user",
              parts: [
                {
                  text: "Do not give suggestions. From now on, whenever the user asks a question about my information, get the relevant parts from the data context, and answer the user's question using it"
                }
              ]
            },
            {
              role: "model",
              parts: [
                {
                  text: "Understood. From this point forward, I will only answer questions about your information by directly extracting relevant details from the provided data context and synthesizing them into a concise response. I will avoid offering any suggestions or advice beyond that.\n"
                }
              ]
            },
            // Include previous chat history
            ...conversationHistory.map((msg: { role: string; content: string }) => ({
              role: msg.role,
              parts: [{ text: msg.content }]
            })),
            // Add the new message
            {
              role: "user",
              parts: [{ text: message }]
            }
          ],
          generationConfig: {
            temperature: 1,
            topK: 40,
            topP: 0.95,
            maxOutputTokens: 8192,
            responseMimeType: "text/plain"
          }
        }),
      }
    );

    if (!response.ok) {
      const errorData = await response.json();
      throw new Error(`API request failed: ${errorData.error?.message || response.statusText}`);
    }

    const data = await response.json();
    res.status(200).json(data);
  } catch (error) {
    console.error('Error calling Gemini API:', error);
    res.status(500).json({ error: 'Failed to generate response' });
  }
} 